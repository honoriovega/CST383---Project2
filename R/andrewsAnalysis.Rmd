### Data
```{r}
library(rpart)
library(rpart.plot)
library(maptree)
setwd('..')
dat = read.csv( paste0(getwd(), "/data/Video_Game_Sales_as_of_Jan_2017.csv"))
source("https://raw.githubusercontent.com/grbruns/cst383/master/lin-regr-util.R")
```

```{r}
# 7191 complete cases
set.seed(123)
before = nrow(dat)

# get all the complete cases
# we retain 41% of our data and discard 59%
dat = dat[complete.cases(dat),]
after = nrow(dat)
print(after/before)

# Converting column names from uppers to lowers
names(dat) = tolower(names(dat))
str(dat)
summary(dat)

# Adding column 'hit' based off of global sales threshold of 1 mil copies sold
#dat$hit = factor(ifelse(dat$global_sales>=1, 1, 0))
```


```{r}
barplot(table(dat$genre),horiz=TRUE,las=1)
```


```{r}
# Critic Score
plot(critic_score ~ genre, data=dat, main="Critic Score by Genre", xlab="Genre", ylab="Critic Score", col="RED")
# User Score
plot(user_score ~ genre, data=dat, main="User Score by Genre", xlab="Genre", ylab="User Score", col="RED")
```

```{r}
plot(global_sales[hit==1] ~ critic_score[hit==1], data=dat, col="RED", pch=20, xlab="Critic Score", ylab="Global Sales", main="Critic Score by Global Sales")
points(global_sales[hit==0] ~ critic_score[hit==0], data=dat, col="NAVY", pch=20)
legend("topleft", col=c("RED","NAVY"), legend=c(">1MIL IN SALES", "<1MIL IN SALES"), pch=15)
```

```{r}
par(mar=c(4,9,1,3))
barplot(table(dat$hit, dat$genre), col=c("RED","NAVY"), horiz=T, las=1)
```


```{r}
par(mar=c(4,9,1,3))
barplot(sort(table(dat$platform),ascending=T),horiz=T, las=1, col="RED", main="Games per Platform")
```


### Sampling & Splitting
```{r}
# 
set.seed(123)

tr_rows = sample(nrow(dat), 0.7 * nrow(dat))
tr_dat = dat[tr_rows,]
te_dat = dat[-tr_rows,]
```


### Linear Regression
```{r}

fit = lm(global_sales ~ user_count + user_score, data=tr_dat)
# Summary
summary(fit)

# Conf Mtx
#temp = predict(fit, newdata=te_dat, type="response")
#predicts = as.numeric(temp > 0.7)
#actuals = te_dat$hit
#conf_mtx = table(predicts, actuals)
#conf_mtx
```

```{r}
# Plot
plot(tr_dat$global_sales ~ predict(fit), data=tr_dat, col="DARK RED", pch=20, main="Actual Global Sales by Predicted Global Sales", xlab="Predicted", ylab="Sales")
abline(a=0, b=1, col="BLUE", lty=2, lwd=2)
```


### RMSE
```{r}
predicted = predict(fit, te_dat)
errors = te_dat$global_sales-predicted
plot(density(errors))

# RMSE
rmse = sqrt(mean(errors^2))
rmse
```


Some more ideas to explore. 
  - Number of games per platform to find out which platform has the most games.
  - Does a certain genre sell more than others
  - Developers/publishers that produce the most games
  - Is there a certain Devloper/publisher that sell the most


