### Data
```{r}
library(rpart)
library(rpart.plot)
library(maptree)
setwd('..')
dat = read.csv( paste0(getwd(), "/data/Video_Game_Sales_as_of_Jan_2017.csv"))
```

```{r}
# 7191 complet cases
set.seed(123)
before = nrow(dat)

# Converting column names from uppers to lowers
names(dat) = tolower(names(dat))

# get all the complete cases
# we retain 41% of our data and discard 59%

dat = dat[complete.cases(dat),]
barplot(table(dat$year_of_release),horiz=TRUE,las=1)

# get rid of video games where the data was prior to 2000 based on the barplot
# they don't contribute much
dat = dat[as.numeric(as.character(dat$year_of_release)) >= 2000,]
barplot(table(dat$year_of_release),horiz=TRUE,las=1)


# based on this throw away games before 2000 because they don't contribute much
sum(dat$year_of_release >= 2000)
barplot(table(dat$year_of_release),horiz=TRUE,las=1)

after = nrow(dat)

print(after/before)


dat$hit = factor(ifelse(dat$global_sales>=1, 1, 0))

# we are predicitng global sales
tr_rows = sample(nrow(dat), 0.7 * nrow(dat))
tr_dat = dat[tr_rows,]
te_dat = dat[-tr_rows,]


fit = glm(hit ~  critic_score, family=binomial(), data=tr_dat)
temp = predict(fit, newdata=te_dat, type="response")
predicts = as.numeric(temp > 0.7)
actuals = te_dat$hit
conf_mtx = table(predicts, actuals)
conf_mtx

succ_rate = mean(predicts == actuals)
succ_rate


#0.8220575 - success rate using linear regression to predict global sales using critic_score

```